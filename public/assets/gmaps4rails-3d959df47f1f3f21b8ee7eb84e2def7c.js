(function(){var e;e={},e.triggerOldOnload=function(){return"function"==typeof e.oldOnload?e.oldOnload():void 0},e.loadMaps=function(){var t,r,o,i,n;n=[];for(t in e)i=e[t],o=t.search(/load/),-1===o?(r="load_"+t,n.push(e[r]())):n.push(void 0);return n},window.Gmaps=e,this.Gmaps4Rails=function(){function e(){this.map=null,this.serviceObject=null,this.visibleInfoWindow=null,this.userLocation=null,this.geolocationFailure=function(){return!1},this.callback=function(){return!1},this.customClusterer=function(){return!1},this.infobox=function(){return!1},this.jsTemplate=!1,this.default_map_options={id:"map",draggable:!0,detect_location:!1,center_on_user:!1,center_latitude:0,center_longitude:0,zoom:7,maxZoom:null,minZoom:null,auto_adjust:!0,auto_zoom:!0,bounds:[],raw:{}},this.default_markers_conf={title:"",picture:"",width:22,length:32,draggable:!1,do_clustering:!1,randomize:!1,max_random_distance:100,list_container:null,offset:0,raw:{}},this.markers=[],this.boundsObject=null,this.polygons=[],this.polylines=[],this.circles=[],this.markerClusterer=null,this.markerImages=[],this.polylines_conf={strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,clickable:!1,zIndex:null}}return e.prototype.initialize=function(){return this.serviceObject=this.createMap(),this.map=this.serviceObject,(this.map_options.detect_location===!0||this.map_options.center_on_user===!0)&&this.findUserLocation(this),this.resetSidebarContent()},e.prototype.findUserLocation=function(e){var t,r;return navigator.geolocation?(r=function(t){return e.userLocation=e.createLatLng(t.coords.latitude,t.coords.longitude),e.map_options.center_on_user===!0?e.centerMapOnUser():void 0},t=function(){return e.geolocationFailure(!0)},navigator.geolocation.getCurrentPosition(r,t)):e.geolocationFailure(!1)},e.prototype.create_direction=function(){var e,t,r;return e=new google.maps.DirectionsRenderer,t=new google.maps.DirectionsService,e.setMap(this.serviceObject),this.direction_conf.display_panel&&e.setPanel(document.getElementById(this.direction_conf.panel_id)),e.setOptions({suppressMarkers:!1,suppressInfoWindows:!1,suppressPolylines:!1}),r={origin:this.direction_conf.origin,destination:this.direction_conf.destination,waypoints:this.direction_conf.waypoints,optimizeWaypoints:this.direction_conf.optimizeWaypoints,unitSystem:google.maps.DirectionsUnitSystem[this.direction_conf.unitSystem],avoidHighways:this.direction_conf.avoidHighways,avoidTolls:this.direction_conf.avoidTolls,region:this.direction_conf.region,travelMode:google.maps.DirectionsTravelMode[this.direction_conf.travelMode],language:"en"},t.route(r,function(t,r){return r===google.maps.DirectionsStatus.OK?e.setDirections(t):void 0})},e.prototype.create_circles=function(){var e,t,r,o,i;for(o=this.circles,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.create_circle(e));return i},e.prototype.create_circle=function(e){var t;return e===this.circles[0]&&(null!=e.strokeColor&&(this.circles_conf.strokeColor=e.strokeColor),null!=e.strokeOpacity&&(this.circles_conf.strokeOpacity=e.strokeOpacity),null!=e.strokeWeight&&(this.circles_conf.strokeWeight=e.strokeWeight),null!=e.fillColor&&(this.circles_conf.fillColor=e.fillColor),null!=e.fillOpacity&&(this.circles_conf.fillOpacity=e.fillOpacity)),null!=e.lat&&null!=e.lng?(t=new google.maps.Circle({center:this.createLatLng(e.lat,e.lng),strokeColor:e.strokeColor||this.circles_conf.strokeColor,strokeOpacity:e.strokeOpacity||this.circles_conf.strokeOpacity,strokeWeight:e.strokeWeight||this.circles_conf.strokeWeight,fillOpacity:e.fillOpacity||this.circles_conf.fillOpacity,fillColor:e.fillColor||this.circles_conf.fillColor,clickable:e.clickable||this.circles_conf.clickable,zIndex:e.zIndex||this.circles_conf.zIndex,radius:e.radius}),e.serviceObject=t,t.setMap(this.serviceObject)):void 0},e.prototype.clear_circles=function(){var e,t,r,o,i;for(o=this.circles,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.clear_circle(e));return i},e.prototype.clear_circle=function(e){return e.serviceObject.setMap(null)},e.prototype.hide_circles=function(){var e,t,r,o,i;for(o=this.circles,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.hide_circle(e));return i},e.prototype.hide_circle=function(e){return e.serviceObject.setMap(null)},e.prototype.show_circles=function(){var e,t,r,o,i;for(o=this.circles,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.show_circle(this.circle));return i},e.prototype.show_circle=function(e){return e.serviceObject.setMap(this.serviceObject)},e.prototype.create_polygons=function(){var e,t,r,o,i;for(o=this.polygons,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.create_polygon(e));return i},e.prototype.create_polygon=function(e){var t,r,o,i,n,s,a,c,l,h,p,u;for(a=[],p=0,u=e.length;u>p;p++)s=e[p],i=this.createLatLng(s.lat,s.lng),a.push(i),s===e[0]&&(c=s.strokeColor||this.polygons_conf.strokeColor,l=s.strokeOpacity||this.polygons_conf.strokeOpacity,h=s.strokeWeight||this.polygons_conf.strokeWeight,r=s.fillColor||this.polygons_conf.fillColor,o=s.fillOpacity||this.polygons_conf.fillOpacity,t=s.clickable||this.polygons_conf.clickable);return n=new google.maps.Polygon({paths:a,strokeColor:c,strokeOpacity:l,strokeWeight:h,fillColor:r,fillOpacity:o,clickable:t,map:this.serviceObject}),e.serviceObject=n},e.prototype.create_markers=function(){return this.createServiceMarkersFromMarkers(),this.clusterize()},e.prototype.createServiceMarkersFromMarkers=function(){var e,t,r,o,i,n,s;for(s=this.markers,o=0,n=s.length;n>o;o++)i=s[o],null==this.markers[o].serviceObject&&(e=this.markers[o].lat,r=this.markers[o].lng,this.markers_conf.randomize&&(t=this.randomize(e,r),e=t[0],r=t[1]),this.markers[o].serviceObject=this.createMarker({marker_picture:this.markers[o].picture?this.markers[o].picture:this.markers_conf.picture,marker_width:this.markers[o].width?this.markers[o].width:this.markers_conf.width,marker_height:this.markers[o].height?this.markers[o].height:this.markers_conf.length,marker_title:this.markers[o].title?this.markers[o].title:null,marker_anchor:this.markers[o].marker_anchor?this.markers[o].marker_anchor:null,shadow_anchor:this.markers[o].shadow_anchor?this.markers[o].shadow_anchor:null,shadow_picture:this.markers[o].shadow_picture?this.markers[o].shadow_picture:null,shadow_width:this.markers[o].shadow_width?this.markers[o].shadow_width:null,shadow_height:this.markers[o].shadow_height?this.markers[o].shadow_height:null,marker_draggable:this.markers[o].draggable?this.markers[o].draggable:this.markers_conf.draggable,rich_marker:this.markers[o].rich_marker?this.markers[o].rich_marker:null,zindex:this.markers[o].zindex?this.markers[o].zindex:null,Lat:e,Lng:r,index:o}),this.createInfoWindow(this.markers[o]),this.createSidebar(this.markers[o]));return this.markers_conf.offset=this.markers.length},e.prototype.createImageAnchorPosition=function(e){return null===e?null:this.createPoint(e[0],e[1])},e.prototype.replaceMarkers=function(e){return this.clearMarkers(),this.markers=new Array,this.boundsObject=this.createLatLngBounds(),this.resetSidebarContent(),this.markers_conf.offset=0,this.addMarkers(e)},e.prototype.addMarkers=function(e){return this.markers=this.markers.concat(e),this.create_markers(),this.adjustMapToBounds()},e.prototype.createSidebar=function(e){var t,r,o,i,n;return this.markers_conf.list_container?(n=document.getElementById(this.markers_conf.list_container),i=document.createElement("li"),t=document.createElement("a"),t.href="javascript:void(0);",o=null!=e.sidebar?e.sidebar:"Marker",t.innerHTML=o,r=this,t.onclick=this.sidebar_element_handler(r,e.serviceObject,"click"),i.appendChild(t),n.appendChild(i)):void 0},e.prototype.sidebar_element_handler=function(e,t,r){return function(){return e.map.panTo(t.position),google.maps.event.trigger(t,r)}},e.prototype.resetSidebarContent=function(){var e;return null!==this.markers_conf.list_container?(e=document.getElementById(this.markers_conf.list_container),e.innerHTML=""):void 0},e.prototype.adjustMapToBounds=function(){return this.map_options.auto_adjust||null!==this.map_options.bounds?(this.boundsObject=this.createLatLngBounds(),this.map_options.auto_adjust&&(this.extendBoundsWithMarkers(),this.updateBoundsWithPolylines(),this.updateBoundsWithPolygons(),this.updateBoundsWithCircles()),this.extendMapBounds(),this.adaptMapToBounds()):void 0},e.prototype.replacePolylines=function(e){return this.destroy_polylines(),this.polylines=e,this.create_polylines(),this.adjustMapToBounds()},e.prototype.destroy_polylines=function(){var e,t,r,o;for(o=this.polylines,t=0,r=o.length;r>t;t++)e=o[t],e.serviceObject.setMap(null);return this.polylines=[]},e.prototype.create_polylines=function(){var e,t,r,o,i;for(o=this.polylines,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.create_polyline(e));return i},e.prototype.exists=function(e){return""!==e&&"undefined"!=typeof e},e.prototype.randomize=function(e,t){var r,o,i,n;return i=this.markers_conf.max_random_distance*this.random(),n=this.markers_conf.max_random_distance*this.random(),r=parseFloat(e)+180/Math.PI*(n/6378137),o=parseFloat(t)+90/Math.PI*(i/6378137)/Math.cos(e),[r,o]},e.prototype.mergeObjectWithDefault=function(e,t){var r,o,i;r={};for(o in e)i=e[o],r[o]=i;for(o in t)i=t[o],null==r[o]&&(r[o]=i);return r},e.prototype.mergeWithDefault=function(e){var t,r;return t=this["default_"+e],r=this[e],this[e]=this.mergeObjectWithDefault(r,t),!0},e.prototype.random=function(){return 2*Math.random()-1},e}()}).call(this),function(){var e=Object.prototype.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4RailsGoogle=function(e){function r(){r.__super__.constructor.apply(this,arguments),this.map_options={disableDefaultUI:!1,disableDoubleClickZoom:!1,type:"ROADMAP"},this.markers_conf={clusterer_gridSize:50,clusterer_maxZoom:5,custom_cluster_pictures:null,custom_infowindow_class:null},this.mergeWithDefault("map_options"),this.mergeWithDefault("markers_conf"),this.kml_options={clickable:!0,preserveViewport:!1,suppressInfoWindows:!1},this.polygons_conf={strokeColor:"#FFAA00",strokeOpacity:.8,strokeWeight:2,fillColor:"#000000",fillOpacity:.35,clickable:!1},this.circles_conf={fillColor:"#00AAFF",fillOpacity:.35,strokeColor:"#FFAA00",strokeOpacity:.8,strokeWeight:2,clickable:!1,zIndex:null},this.direction_conf={panel_id:null,display_panel:!1,origin:null,destination:null,waypoints:[],optimizeWaypoints:!1,unitSystem:"METRIC",avoidHighways:!1,avoidTolls:!1,region:null,travelMode:"DRIVING"}}return t(r,e),r.prototype.createPoint=function(e,t){return new google.maps.Point(e,t)},r.prototype.createLatLng=function(e,t){return new google.maps.LatLng(e,t)},r.prototype.createLatLngBounds=function(){return new google.maps.LatLngBounds},r.prototype.createMap=function(){var e,t;return e={maxZoom:this.map_options.maxZoom,minZoom:this.map_options.minZoom,zoom:this.map_options.zoom,center:this.createLatLng(this.map_options.center_latitude,this.map_options.center_longitude),mapTypeId:google.maps.MapTypeId[this.map_options.type],mapTypeControl:this.map_options.mapTypeControl,disableDefaultUI:this.map_options.disableDefaultUI,disableDoubleClickZoom:this.map_options.disableDoubleClickZoom,draggable:this.map_options.draggable},t=this.mergeObjectWithDefault(this.map_options.raw,e),new google.maps.Map(document.getElementById(this.map_options.id),t)},r.prototype.createMarkerImage=function(e,t,r,o,i){return new google.maps.MarkerImage(e,t,r,o,i)},r.prototype.createSize=function(e,t){return new google.maps.Size(e,t)},r.prototype.createMarker=function(e){var t,r,o,i,n,s,a;return i=this.createLatLng(e.Lat,e.Lng),""===e.marker_picture&&null===e.rich_marker?(t={position:i,map:this.serviceObject,title:e.marker_title,draggable:e.marker_draggable,zIndex:e.zindex},n=this.mergeObjectWithDefault(this.markers_conf.raw,t),new google.maps.Marker(n)):null!==e.rich_marker?new RichMarker({position:i,map:this.serviceObject,draggable:e.marker_draggable,content:e.rich_marker,flat:null===e.marker_anchor?!1:e.marker_anchor[1],anchor:null===e.marker_anchor?0:e.marker_anchor[0],zIndex:e.zindex}):(r=this.createImageAnchorPosition(e.marker_anchor),s=this.createImageAnchorPosition(e.shadow_anchor),o=this.createOrRetrieveImage(e.marker_picture,e.marker_width,e.marker_height,r),a=this.createOrRetrieveImage(e.shadow_picture,e.shadow_width,e.shadow_height,s),t={position:i,map:this.serviceObject,icon:o,title:e.marker_title,draggable:e.marker_draggable,shadow:a,zIndex:e.zindex},n=this.mergeObjectWithDefault(this.markers_conf.raw,t),new google.maps.Marker(n))},r.prototype.includeMarkerImage=function(e,t){var r,o,i;for(r=0,i=e.length;i>r;r++)if(o=e[r],o.url===t)return r;return!1},r.prototype.createOrRetrieveImage=function(e,t,r,o){var i,n;if(""===e||null===e)return null;switch(n=this.includeMarkerImage(this.markerImages,e)){case!1:return i=this.createMarkerImage(e,this.createSize(t,r),null,o,null),this.markerImages.push(i),i;default:return"number"==typeof n?this.markerImages[n]:!1}},r.prototype.clearMarkers=function(){var e,t,r,o,i;for(o=this.markers,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.clearMarker(e));return i},r.prototype.showMarkers=function(){var e,t,r,o,i;for(o=this.markers,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.showMarker(e));return i},r.prototype.hideMarkers=function(){var e,t,r,o,i;for(o=this.markers,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.hideMarker(e));return i},r.prototype.clearMarker=function(e){return e.serviceObject.setMap(null)},r.prototype.showMarker=function(e){return e.serviceObject.setVisible(!0)},r.prototype.hideMarker=function(e){return e.serviceObject.setVisible(!1)},r.prototype.extendBoundsWithMarkers=function(){var e,t,r,o,i;for(o=this.markers,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.boundsObject.extend(e.serviceObject.position));return i},r.prototype.createClusterer=function(e){return new MarkerClusterer(this.serviceObject,e,{maxZoom:this.markers_conf.clusterer_maxZoom,gridSize:this.markers_conf.clusterer_gridSize,styles:this.customClusterer()})},r.prototype.clearClusterer=function(){return this.markerClusterer.clearMarkers()},r.prototype.clusterize=function(){var e,t,r,o,i;if(this.markers_conf.do_clustering===!0){for(null!==this.markerClusterer&&this.clearClusterer(),t=new Array,i=this.markers,r=0,o=i.length;o>r;r++)e=i[r],t.push(e.serviceObject);return this.markerClusterer=this.createClusterer(t)}},r.prototype.createInfoWindow=function(e){var t,r;return"function"==typeof this.jsTemplate||null!=e.description?("function"==typeof this.jsTemplate&&(e.description=this.jsTemplate(e)),null!==this.markers_conf.custom_infowindow_class?(t=document.createElement("div"),t.setAttribute("class",this.markers_conf.custom_infowindow_class),t.innerHTML=e.description,e.infowindow=new InfoBox(this.infobox(t)),r=this,google.maps.event.addListener(e.serviceObject,"click",this.openInfoWindow(r,e.infowindow,e.serviceObject))):(e.infowindow=new google.maps.InfoWindow({content:e.description}),r=this,google.maps.event.addListener(e.serviceObject,"click",this.openInfoWindow(r,e.infowindow,e.serviceObject)))):void 0},r.prototype.openInfoWindow=function(e,t,r){return function(){return null!==e.visibleInfoWindow&&e.visibleInfoWindow.close(),t.open(e.serviceObject,r),e.visibleInfoWindow=t}},r.prototype.createKmlLayer=function(e){var t;return t=e.options||{},t=this.mergeObjectWithDefault(t,this.kml_options),e=new google.maps.KmlLayer(e.url,t),e.setMap(this.serviceObject),e},r.prototype.create_polyline=function(e){var t,r,o,i,n,s,a,c,l,h,p,u,d,m,f;for(a=[],u=0,m=e.length;m>u;u++)if(o=e[u],null!=o.coded_array)for(r=new google.maps.geometry.encoding.decodePath(o.coded_array),d=0,f=r.length;f>d;d++)s=r[d],a.push(s);else o===e[0]&&(c=o.strokeColor||this.polylines_conf.strokeColor,l=o.strokeOpacity||this.polylines_conf.strokeOpacity,h=o.strokeWeight||this.polylines_conf.strokeWeight,t=o.clickable||this.polylines_conf.clickable,p=o.zIndex||this.polylines_conf.zIndex),null!=o.lat&&null!=o.lng&&(i=this.createLatLng(o.lat,o.lng),a.push(i));return n=new google.maps.Polyline({path:a,strokeColor:c,strokeOpacity:l,strokeWeight:h,clickable:t,zIndex:p}),e.serviceObject=n,n.setMap(this.serviceObject)},r.prototype.updateBoundsWithPolylines=function(){var e,t,r,o,i,n,s;for(n=this.polylines,s=[],o=0,i=n.length;i>o;o++)t=n[o],r=t.serviceObject.latLngs.getArray()[0].getArray(),s.push(function(){var t,o,i;for(i=[],t=0,o=r.length;o>t;t++)e=r[t],i.push(this.boundsObject.extend(e));return i}.call(this));return s},r.prototype.create_kml=function(){var e,t,r,o,i;for(o=this.kml,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(e.serviceObject=this.createKmlLayer(e));return i},r.prototype.fitBounds=function(){return this.boundsObject.isEmpty()?void 0:this.serviceObject.fitBounds(this.boundsObject)},r.prototype.centerMapOnUser=function(){return this.serviceObject.setCenter(this.userLocation)},r.prototype.updateBoundsWithPolygons=function(){var e,t,r,o,i,n,s;for(n=this.polygons,s=[],o=0,i=n.length;i>o;o++)t=n[o],r=t.serviceObject.latLngs.getArray()[0].getArray(),s.push(function(){var t,o,i;for(i=[],t=0,o=r.length;o>t;t++)e=r[t],i.push(this.boundsObject.extend(e));return i}.call(this));return s},r.prototype.updateBoundsWithCircles=function(){var e,t,r,o,i;for(o=this.circles,i=[],t=0,r=o.length;r>t;t++)e=o[t],this.boundsObject.extend(e.serviceObject.getBounds().getNorthEast()),i.push(this.boundsObject.extend(e.serviceObject.getBounds().getSouthWest()));return i},r.prototype.extendMapBounds=function(){var e,t,r,o,i;for(o=this.map_options.bounds,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(this.boundsObject.extend(this.createLatLng(e.lat,e.lng)));return i},r.prototype.adaptMapToBounds=function(){var e;return this.map_options.auto_zoom?this.fitBounds():(e=this.boundsObject.getCenter(),this.map_options.center_latitude=e.lat(),this.map_options.center_longitude=e.lng(),this.serviceObject.setCenter(e))},r}(Gmaps4Rails)}.call(this);